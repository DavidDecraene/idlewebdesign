<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Web Evolution</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="css/odometer-theme-minimal.css" >
  <link rel="stylesheet" href="css/odometer-theme-train-station.css" >

  <style type="text/css">

  .old-button {
    border: 1px solid black;
    padding: 5px 7px;
  }

  .info {
    margin-top: 10px;
  }

  .phase {
    padding: 5px;
    margin-top: 15px;
    display: none;
      border-radius: 5px;
      box-shadow: 0 2px 4px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12)!important;
      min-height: 230px;
      margin-bottom: 5px;
  }
  .prehistoric a {
    color: #00F;
    text-decoration: underline;
  }
  #fugly-era {
    background-image: url(img/bg0009.gif) ;
    color: #000;
  }
  #fugly-era a {
    color: #00F;
    text-decoration: underline;
  }
  #justno {
    font-family: Comic Sans MS, Comic Sans;
    background-color: #2626FF;
    color: #FFFF00;
  }

  blink {
    -webkit-animation: 2s linear infinite condemned_blink_effect; // for android
    animation: 2s linear infinite condemned_blink_effect;
}
@-webkit-keyframes condemned_blink_effect { // for android
    0% {
        visibility: hidden;
    }
    50% {
        visibility: hidden;
    }
    100% {
        visibility: visible;
    }
}
@keyframes condemned_blink_effect {
    0% {
        visibility: hidden;
    }
    50% {
        visibility: hidden;
    }
    100% {
        visibility: visible;
    }
}
  </style>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script>
    odometerOptions = { auto: false };
  </script>
    <script src="js/odometer.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
      var odometer1 = new Odometer({ el: $('#odometer1')[0], theme: 'minimal', value : '0' });
      odometer1.render();
      odometer1.update(10);
      var odometer = new Odometer({ el: $('#odometer2')[0], theme: 'train-station', value : '0' });
      odometer.render();
      odometer.update(1230000);

      (function() {

        class VisitIncrementor {

          constructor() {
            this.rate =  1;
            this.value = 0;
            this.multiplier = 1.07;
            this.costBase = 10;
            this.cost = this.costBase;
          }

          calculateNext() {
            this.cost = this.costBase * Math.pow(this.multiplier, this.value);
          }

          buy(model, amount = 1) {
            if (amount == 1 || !this.value) {
              if(model.visitors.count < this.cost) return false;
              model.visitors.add(-this.cost);
              this.value++;
              this.calculateNext();
              return true;
            } else if(amount > 1) {
              const r = this.multiplier;
              const pluralCost = this.costBase * Math.pow(r, this.value) * ( Math.pow(r, amount)  - 1) / (r - 1);
              if(model.visitors.count < pluralCost) return false;
              model.visitors.add(-pluralCost);
              this.value += amount;
              this.calculateNext();
              return true;
            }
            return false;
          }

          maxBuy(income) {
            const ll = (income * (r - 1) / (this.costBase * Math.pow(this.multiplier, this.value))) + 1;
            const maxBuy = Math.floor(Math.log(ll) / Math.log(this.multiplier));
            return maxBuy;
          }

          update(model) {
            model.visitors.add(this.value * this.rate); // Linear grow
          }
        }


        class Phase {
          constructor($element, options) {
            this.$element = $element;
            this.incrementors = [];
            this.$title = $('h1', $element);
            this.$log = $('.log', $element);
            this.data = $.extend(true, { footer: {}}, options);
            this.footer = new Footer($('.footer', $element), this.data.footer);
            this.render();
          }

          restore(json) {
            if(!json) return;
          }

          save() {
            return {

            }
          }

          render() {
            this.$element.removeClass();
            this.$element.addClass('phase');
            this.$element.addClass(this.data.id);
            if (this.data.title) {
              this.$title.text(this.data.title);
            }
          }

          notifyVisitors(count) {

          }

          toggle(state) {
            const vis = this.$element.is(':visible');
            if(state !== undefined) {
              if(state === vis) { return; }
              this.$element.toggle();
              return;
            }
            this.$element.toggle();
          }

          update(ticks) {
            this.incrementors.forEach(incr => {
              incr.update(this.model);
            });
          }

        }

        class WOMOption {


            constructor($parent, model, options) {
              this.data = $.extend({}, options);
              this.value = new VisitIncrementor();
              this.$element = $('<div></div>').appendTo($parent);
              this.initRender();
              this.updateCost();
              this.update = this.value.update.bind(this.value);
            }


            initRender() {
              $('<span/>').text(this.data.name).appendTo(this.$element);
              $('<span>: </span>').appendTo(this.$element);
              this.$button = $('<span class="old-button">+</span>').appendTo(this.$element).click(() => {
                if(this.value.buy(model, 1))
                this.updateCost();
              });
              $('<span>: Requires </span>').appendTo(this.$element);
              this.$cost = $('<span class="cost">10</span>').appendTo(this.$element);
              $('<span> visitors.</span>').appendTo(this.$element);

            }

            updateCost() {
              this.$cost.text(Math.ceil(this.value.cost));
            }
        }

        class Footer {
          constructor($element, options) {
            this.$element = $element;
            this.data = $.extend(true, { }, options);
            this.$text = $('.text', $element);
            this.render();
          }

          render() {
            this.$text.text(this.data.text);
          }
        }

        class Prehistory extends Phase {

          constructor($element) {
            super($element, {
              id: 'prehistoric',
              title: 'The start of it all',
              footer: {
                text: 'This is your footer. You haven\'t figured out what to write here yet.'
              }
            });
            $('.visit', $element).click(() => {
              if(!this.model) { return; }
              this.model.addVisitor();
            });

          }

          notifyVisitors(count) {
            if(!this.wordOfMouth && count >= 10) {
              const holder = $('.automation', this.$element).show();
              this.wordOfMouth = new WOMOption(holder, this.model, {
                name: 'Word of mouth'
              });
              this.incrementors.push(this.wordOfMouth);
            }
          }

        }
        class HreyPhase extends Phase {
          constructor($element) {
            super($element);
          }
        }
        class JustNoPhase extends Phase {
          constructor($element) {
            super($element);
          }
        }
        class FuglyEraPhase extends Phase {
          constructor($element) {
            super($element);
          }
        }
        class TableGalorePhase extends Phase {
          constructor($element) {
            super($element);
          }
        }

        class Visitors {

          constructor(){
            this.$element = $('.visitors');
            this.count = 0;
            this.iCount = 0;
          }

          add(count ) {
            this.count += count;
            const oldCount = this.iCount;
            this.iCount = Math.floor(this.count);
            if(oldCount !== this.iCount) this.$element.text(this.iCount);
          }

          restore(json) {
            if(!json) return;
            this.count = json.count;
            this.iCount =  Math.floor(this.count);
          }

          save() {
            return {
              count: this.count;
            };
          }

        }

        class Frame {
          constructor(model) {
            this.time = 0;
            this.model =  model;
            this.cycles = 0;
          }

          cycle(timestamp) {
            if (!this.time) { this.time = timestamp; }
            const progress = timestamp - this.time;
            if(progress > 1000) {
              this.time = this.time + 1000;
              if (this.model.phase) this.model.phase.update(1);
              if(!(++this.cycles % 30)) {
                console.log('should save');
              }
            }
            window.requestAnimationFrame(this.cycle.bind(this));
          }

          start() {
              window.requestAnimationFrame(this.cycle.bind(this));
          }


        }

        class Model {
          constructor() {
            this.phases = [];
            this.phase = undefined;
            this.visitors = new Visitors();
            this.renown = 0;
            this.frame = new Frame(this);
          }

          addVisitor(count = 1) {
            const oldVal = this.visitors.iCount;
            this.visitors.add(count);
            if(oldVal !== this.visitors.iCount) {
              if( this.phase) { this.phase.notifyVisitors(this.visitors.count); }

            }
          }

          restore(json) {
            if(!json) return;
            const phaseId = json.phase.id;
            if('prehistoric' === phaseId) {
              this.phase = new Prehistory($('#phase'));
              this.phase.model = this;
              this.phase.restore(json.phase);
              this.phase.toggle(true);
            }
            this.visitors.restore(json.visitors);
          }

          save() {
            return {
              phase : this.phase.save(),
              renown: this.renown,
              visitors : this.visitors.save()
            }
          }

          addPhase(phase) {
            this.phases.push(phase);
            phase.model  = this;
            const currentPhase = this.phases.length === 1;
            phase.toggle(currentPhase);
            if (currentPhase) { this.phase = phase; }
          }

        }
        const model = new Model();



        model.addPhase(new Prehistory($('#phase')));
        model.addPhase(new HreyPhase($('#hrey')));
        model.addPhase(new JustNoPhase($('#justno')));
        model.addPhase(new FuglyEraPhase($('#fugly-era')));
        model.addPhase(new TableGalorePhase($('#table-galore')));
        model.frame.start();
      })();

    });


    </script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
        <div class="col col-sm-2">

        </div>
        <div class="col col-sm-8">

          <div id="phase">
            <h1></h1>
            <p class="log">You write your first lines of html code</p>
            <a href="#" class="visit">Click here</a> .
            <div class="automation" style="display:none">
              <hr  />
              <h2>Referrals</h2>
            </div>
            <div class="footer">
              <hr/>
              <div class="text"></div>
            </div>
          </div>
        </div>
        <div class="col col-sm-2">

        </div>
    </div>
  </div>
  <div class="container phase" id="hrey" style="background-color: #CECECE;font-family:times">
    <h1>Hrey</h1>
    <a href="#">Click here</a> for no reason.

    <hr/>
A Footer <span class="odometer" id="odometer1">0</span>

  </div>
  <div class="container phase" id="justno">
    <h1 style="text-shadow: 2px 2px red;">JustNo <image src="img/hot.gif"/></h1>
    <a href="#">Hyperlink</a>
    <image src="img/tM18j.gif"/>

    <hr/>
A Footer <span class="odometer" id="odometer2">0</span>
  </div>
  <div class="container phase" id="fugly-era">
    <h1>Fugly Era <image src="img/spinningearth.gif"/></h1>
    <a href="#">Hyperlink</a>
    <blink style="color:#FFF">Horrible blink</blink>
    <image src="img/ns_logo.gif"/>
    <image src="img/ie_logo.gif"/>
    <image src="img/noframes.gif"/>
    <image src="img/notepad.gif"/>
    <hr/>
    <a href="#">Hyperlink</a> | <a href="#">Hyperlink</a> | <a href="#">Hyperlink</a> | <a href="#">Hyperlink</a> | <a href="#">Hyperlink</a>
  </div>
  <div class="container phase" id="table-galore">
    <table width="100%">
      <tr>
        <td style="background-color:#EEEEEE" colspan="3">
          <h1>Table Galore</h1>
        </td>
      </tr>
      <tr>
      <td style="background-color: #7EE5DA">
        <center>
          <a href="#">Hyperlink</a>
        </center>
      </td>
      <td style="background-color: #70CCC2">
        <center>
          <a href="#">Hyperlink</a>
        </center>

      </td>
      <td style="background-color: #62B3AA">
        <center>
          <a href="#">Hyperlink</a>
        </center>

      </td>

      </tr>
    </table>
    <hr/>
    <center><small>A Footer</small></center>
  </div>
  <div  class="container" id="info">
      <div>Visitors <span class="visitors">0</span></div>
  </div>
  <!-- <a href="http://web.archive.org/web/20010602143252/http://www.pets.com:80/">Next ones</a>-->
</body>

</html>
